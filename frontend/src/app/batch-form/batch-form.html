<div class="sop-create-container">
  <div class="page-header">
    <h1 class="page-title">
      <i class="fas" [ngClass]="isEditMode ? 'fa-edit' : 'fa-plus'"></i>
      {{ isEditMode ? 'Edit Batch' : 'Create Batch' }}
    </h1>
  </div>

  <form (ngSubmit)="saveBatch()" class="sop-form">
    <!-- Basic Information -->
    <div class="form-section">
      <h2>Basic Information</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="batchName">Batch Name *</label>
          <input 
            type="text" 
            id="batchName"
            [(ngModel)]="batchForm.batchName" 
            name="batchName"
            class="form-control"
            placeholder="e.g., Q1 2024 Batch"
            required>
        </div>

        <div class="form-group">
          <label for="batchNumber">Batch Number *</label>
          <input 
            type="text" 
            id="batchNumber"
            [(ngModel)]="batchForm.batchNumber" 
            name="batchNumber"
            class="form-control"
            placeholder="e.g., B001"
            required>
        </div>
      </div>

      <div class="form-group">
        <label for="batchDescription">Description</label>
        <textarea 
          id="batchDescription"
          [(ngModel)]="batchForm.batchDescription" 
          name="batchDescription"
          class="form-control"
          rows="4"
          placeholder="Provide a brief description of this batch"></textarea>
      </div>
    </div>

    <!-- Batch Image -->
    <div class="form-section" *ngIf="!isEditMode">
      <h2>Batch Image (Optional)</h2>
      
      <div class="file-upload">
        <input 
          type="file" 
          id="batchImage"
          accept="image/*"
          (change)="onImageSelect($event)"
          class="file-input">
        
        <label for="batchImage" class="file-input-label">
          <i class="fas fa-cloud-upload-alt"></i>
          Choose Image
        </label>
        
        <p class="file-info">
          Upload batch image (PNG, JPG, GIF up to 5MB)
        </p>
      </div>

      <div class="selected-files" *ngIf="selectedImage">
        <p>
          <i class="fas fa-check-circle"></i>
          Selected: {{ selectedImage.name }}
        </p>
      </div>
    </div>

    <!-- Configuration -->
    <div class="form-section">
      <h2>Configuration</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="status">Status</label>
          <select 
            id="status"
            [(ngModel)]="batchForm.status" 
            name="status"
            class="form-control">
            <option value="active">Active</option>
            <option value="completed">Completed</option>
            <option value="on-hold">On Hold</option>
          </select>
        </div>

        <div class="form-group">
          <label for="tags">Tags</label>
          <input 
            type="text" 
            id="tags"
            [(ngModel)]="batchForm.tags" 
            name="tags"
            class="form-control"
            placeholder="training, development, etc.">
          <small class="form-text">Separate tags with commas</small>
        </div>
      </div>
    </div>

    <!-- Team Members Selection -->
    <div class="form-section">
      <h2>Select Team Members 
        <span class="badge">{{ (batchForm.batchMembers && batchForm.batchMembers.length) || 0 }} selected</span>
      </h2>
      
      <div class="members-selection-box">
        <div *ngIf="loadingMembers" class="loading-state">
          <i class="fas fa-spinner fa-spin"></i>
          Loading team members...
        </div>

        <div *ngIf="!loadingMembers && teamMembers.length > 0" class="members-list">
          <div *ngFor="let member of teamMembers" class="member-item">
            <input 
              type="checkbox" 
              [id]="'member-' + member._id"
              [checked]="isMemberInBatch(member._id)"
              (change)="toggleMemberInBatch(member._id)"
              class="form-checkbox">
            <label [for]="'member-' + member._id" class="member-label">
              <span class="member-name">{{ member.name }}</span>
              <span class="member-email">({{ member.email }})</span>
              <span *ngIf="member.department" class="member-dept">â€¢ {{ member.department }}</span>
            </label>
          </div>
        </div>

        <div *ngIf="!loadingMembers && teamMembers.length === 0" class="empty-state">
          <i class="fas fa-users"></i>
          <p>No team members available</p>
          <small>Add team members first to include them in batches</small>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="loading">
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        <i class="fas fa-save" *ngIf="!loading"></i>
        {{ loading ? (isEditMode ? 'Updating...' : 'Creating...') : (isEditMode ? 'Update Batch' : 'Create Batch') }}
      </button>
      
      <button 
        type="button" 
        class="btn btn-outline-secondary"
        (click)="cancel()"
        [disabled]="loading">
        <i class="fas fa-times"></i>
        Cancel
      </button>
    </div>
  </form>
</div>

